$.fn.fcdp=function(a,b,c){var d=$.type(a);"object"==d?$(this).each(function(){$.fcdp.buildUI($(this),a)}):"string"==d&&$(this).each(function(){$.fcdp.execute($(this),a,b,c)})},$.fcdp={init:function(){$("input[data-date-time]").add($("input[data-date]")).add($("input[data-time]")).each(function(){$.fcdp.buildUI($(this))}),$(document).click(function(){$(".calendar").not(".fixed").find(".date-picker").hide(),$(".calendar").find(".time-picker").hide()})},getFieldDate:function(a){var b=a.input.val();return date=a.nullable&&!b?null:a.nullable||b?moment(b):moment()},setFieldDate:function(a,b){var c=b?b.format(a.formats.value):"";a.input.val(c),b=b?b.add(a.utcOffset,"hours"):b,this.setWorkingDate(a,b)},getWorkingDate:function(a){var b=a.input.data("working-date");return b&&0!=(""+b).length?date=moment(b):(date=moment(),this.setWorkingDate(a,date,!0)),date},setWorkingDate:function(a,b){a.input.data("working-date",b?b.format("YYYY-MM-DD HH:mm:ss"):"");var c="--",d="--";b&&(c=b.format(a.formats.date),d=b.format(a.formats.time)),a.dateSelector&&a.dateSelector.find(".value").html(c),a.timeSelector&&a.timeSelector.find(".value").html(d)},buildUI:function(a,b){a.wrap('<div class="calendar"></div>'),a.wrap('<div class="hidden"></div>'),a.addClass("value");var c=a.closest(".calendar"),d=$('<div class="selector"></div>');c.append(d);var e=a.is("[data-utc-offset]")?parseInt(a.data("utc-offset")):0;e=isNaN(e)?0:e;var f=a.is("[data-time]")||a.is("[data-date-time]")?!0:!1,g=a.is("[data-date]")||a.is("[data-date-time]")?!0:!f,h={input:a,calendar:c,formats:{date:a.is("[data-date-format]")?a.data("date-format"):"dddd: MMMM D, YYYY",time:a.is("[data-time-format]")?a.data("time-format"):"HH:mm A",value:a.is("[data-value-format]")?a.data("value-format"):"YYYY-MM-DD HH:mm:ss"},hasTimePicker:f,hasDatePicker:g,nullable:a.is("[data-nullable]"),utcOffset:e,minDate:a.is("[data-min-date]")?moment(a.data("min-date")):null,maxDate:a.is("[data-max-date]")?moment(a.data("max-date")):null,fixed:a.is("[data-fixed]")?!0:!1};if(b=b?$.extend({},h,b):h,b.fixed&&c.addClass("fixed"),b.hasDatePicker){if(!b.fixed){var i=$('<a class="date-selector"></a>');i.append('<i class="fi-calendar"></i><span class="value"></span>'),d.append(i),d.addClass("date")}var j=$('<div class="date-picker"></div>');c.append(j),j.click(function(a){a.stopPropagation()})}if(b.hasTimePicker&&!b.fixed){var k=$('<a class="time-selector"></a>');k.append('<i class="fi-clock"></i><span class="value"></span>'),d.append(k),d.addClass("time");var l=$('<div class="time-picker"></div>');c.append(l),l.click(function(a){a.stopPropagation()})}if(b.nullable){var m=$('<a class="clear"><i class="fi-x"></i></a>');d.append(m)}d.click(function(a){a.stopPropagation()}),b=$.extend(b,{dateSelector:g?c.find(".date-selector"):null,datePicker:g?c.find(".date-picker"):null,timeSelector:f?d.find(".time-selector"):null,timePicker:f?c.find(".time-picker"):null,clearButton:b.nullable?c.find("a.clear"):null}),c.data("opts",b),a.data("opts",b),b.dateSelector&&b.dateSelector.click(function(a){a.preventDefault();var b=$(this).closest(".calendar"),c=b.find(".time-picker"),d=b.find(".date-picker"),e=b.find(".date-selector");d.css({top:e.position().top+e.outerHeight(),left:e.position().left}),c.hide(),d.toggle()}),b.timeSelector&&c.find("a.time-selector").click(function(a){a.preventDefault();var b=$(this).closest(".calendar"),c=b.find(".date-picker"),d=b.find(".time-picker"),e=b.find(".time-selector");d.css({top:e.position().top+e.outerHeight(),right:e.position().right}),c.hide(),d.toggle()}),b.clearButton&&b.clearButton.click(function(a){a.preventDefault();var b=$(this).closest(".calendar").data("opts");b.datePicker.add(b.timePicker).hide(),$.fcdp.setFieldDate(b,null)}),this.setFieldDate(b,this.getFieldDate(b)),this.buildCalendar(b),this.buildTime(b),this.updateTimePicker(b)},buildTime:function(a){if(tp=a.timePicker){var b=$('<div class="header"></div>'),c=$('<div class="time">Time</div>');b.append(c),tp.append(b);var d=$('<div class="time"></div>'),e=$('<div class="value-control hour"><label>Hr</label><a class="value-change up"><span></span></a><input type="text" class="display" value="12" /><a class="value-change down"><span></span></a></div>'),f=$('<div class="value-control minute"><label>Min</label><a class="value-change up"><span></span></a><input type="text" class="display" value="00" /><a class="value-change down"><span></span></a></div>'),g=$('<div class="value-control second"><label>Sec</label><a class="value-change up"><span></span></a><input type="text" class="display" value="00" /><a class="value-change down"><span></span></a></div>'),h=$('<div class="value-control ampm"><label>A/P</label><a class="value-change up"><span></span></a><input type="text" class="display" value="AM" /><a class="value-change down"><span></span></a></div>');d.append(e),d.append(f),d.append(g),d.append(h),tp.append(d),this.wireupTime(a)}},wireupTime:function(a){if(tp=a.timePicker){var b=tp.find(".value-control.hour");this.wireupTimeValueControl(b,1,12,1);var c=tp.find(".value-control.minute");this.wireupTimeValueControl(c,0,59,2);var d=tp.find(".value-control.second");this.wireupTimeValueControl(d,0,59,2);var e=tp.find(".value-control.ampm");this.wireupTimeAmPmControl(e)}},wireupTimeAmPmControl:function(a){a.find(".value-change").click(function(a){a.preventDefault();var b=$(this),c=b.closest(".value-control"),d=c.find("input.display").val().toLowerCase();d="am"==d?"PM":"AM",c.find("input.display").val(d),$.fcdp.updateTime(b.closest(".calendar").data("opts"))}),a.find("input.display").change(function(){var a=$(this),b=a.closest(".value-control"),c=b.find("input.display").val().toLowerCase()[0];c="p"==c?"PM":"AM",b.find("input.display").val(c),$.fcdp.updateTime(a.closest(".calendar").data("opts"))})},wireupTimeValueControl:function(a,b,c,d){a.data("opts",{max:c,min:b,pad:d}),a.find(".value-change.up").click(function(a){a.preventDefault();var b=$(this),c=b.closest(".value-control"),d=c.data("opts"),e=parseInt(c.find("input.display").val());e+=1,e=e>d.max?d.min:e,c.find("input.display").val(10>e?"0"+e:e);var f=b.closest(".calendar").data("opts");$.fcdp.updateTime(f)}),a.find(".value-change.down").click(function(a){a.preventDefault();var b=$(this),c=b.closest(".value-control"),d=c.data("opts"),e=parseInt(c.find("input.display").val());e-=1,e=e<d.min?d.max:e,c.find("input.display").val(10>e?"0"+e:e);var f=b.closest(".calendar").data("opts");$.fcdp.updateTime(f)}),a.find("input.display").change(function(){var a=$(this),b=a.closest(".value-control"),c=b.data("opts"),d=parseInt(b.find("input.display").val());d=isNaN(d)?c.min:d>c.max?c.max:d<c.min?c.min:d,b.find("input.display").val(10>d?"0"+d:d);var e=a.closest(".calendar").data("opts");$.fcdp.updateTime(e)})},updateTimePicker:function(a){var b;if(b=a.timePicker){var c=this.getWorkingDate(a);c&&(b.find(".value-control.hour").find("input.display").val(c.format("h")),b.find(".value-control.minute").find("input.display").val(c.format("mm")),b.find(".value-control.second").find("input.display").val(c.format("ss")),b.find(".value-control.ampm").find("input.display").val(c.format("A")))}},updateTime:function(a){var b;if(b=a.timePicker){var c=b.find(".value-control.hour").find("input.display").val();c=c?parseInt(c):0;var d=b.find(".value-control.minute").find("input.display").val();d=d?parseInt(d):0;var e=parseInt(b.find(".value-control.second").find("input.display").val());e=e?parseInt(e):0;var f=b.find(".value-control.ampm").find("input.display").val();c=12==c?0:c,"pm"===f.toLowerCase()&&(c+=12),c%=24;var g=this.getWorkingDate(a),h=moment(g).hours(c).minutes(d).seconds(e);h=h?h.add(-a.utcOffset,"hours"):h,this.setFieldDate(a,h),a.input.trigger("timeChange",[a])}},buildCalendar:function(a){var b;if(b=a.datePicker){b.empty();var c=this.getWorkingDate(a),d=this.getFieldDate(a);d=d?d:moment();var e=0,f=moment(c).startOf("month").day(),g=c.daysInMonth()+f,h=$('<div class="week"></div>'),i=moment(this.getWorkingDate(a)).subtract(1,"month"),j=i.daysInMonth(),k=$('<div class="header"></div>');k.append('<a href="#" class="month-nav prev"><span></span</a>'),k.append('<a href="#" class="month-nav next"><span></span></a>'),k.append('<div class="month">'+c.format("MMMM YYYY")+"</div>"),b.append(k);var l=$('<div class="week labels"></div>');for(e=0;7>e;e++)l.append('<div class="day">'+moment().lang()._weekdaysMin[e]+"</div>");for(b.append(l),e=0;42>e;e++){var m=e%7,n={date:null,weekday_num:m,is_weekend:0==m||6==m,is_current:!1,day_number:0};f>e||e>=g?(f>e?n.day_number=j-(f-1)+e:e>=g&&(n.day_number=e-g+1),h.append(this.buildOtherMonthDayUI(a,n))):(n.day_number=e-f+1,n.date=moment(c).date(n.day_number),n.is_current=d.isSame(n.date,"days"),h.append(this.buildDayUI(a,n))),6==m&&(b.append(h),h=$('<div class="week"></div>'))}this.wireupCalendar(a)}},buildOtherMonthDayUI:function(a,b){var c=this.executeBehavior("buildOtherMonthDayUI",a,b);if(!c){var d="day other-month"+(b.is_weekend?" weekend":"");c='<div class="'+d+'">'+b.day_number+"</div>"}return c},buildDayUI:function(a,b){b.is_clickable=this.dateIsClickable(a,b);var c=b.date.date(),d=this.executeBehavior("buildDayUI",a,b);if(!d){var e="day"+(b.is_weekend?" weekend":"")+(b.is_current?" current":"");d=b.is_clickable?'<a href="#'+c+'" class="'+e+'" data-date="'+b.date.format()+'">'+c+"</a>":'<span class="'+e+'" data-date="'+b.date.format()+'">'+c+"</span>"}return d},dateIsClickable:function(a,b){if(a.minDate&&a.minDate.isAfter(b.date)||a.maxDate&&a.maxDate.isBefore(b.date))return!1;var c=this.executeBehavior("dateIsClickable",a,b);return c=null===c?!0:c},wireupCalendar:function(a){var b;(b=a.datePicker)&&(b.find("a.month-nav.prev").click(function(a){a.preventDefault();var b=$(this).closest(".calendar").data("opts"),c=moment($.fcdp.getWorkingDate(b)).subtract(1,"month");$.fcdp.setWorkingDate(b,c),$.fcdp.buildCalendar(b),b.input.trigger("monthChange",[b]),b.input.trigger("monthPrev",[b])}),b.find("a.month-nav.next").click(function(a){a.preventDefault();var b=$(this).closest(".calendar").data("opts"),c=moment($.fcdp.getWorkingDate(b)).add(1,"month");$.fcdp.setWorkingDate(b,c),$.fcdp.buildCalendar(b),b.input.trigger("monthChange",[b]),b.input.trigger("monthNext",[b])}),b.find("a.day").click(function(){var a=$(this),b=a.closest(".calendar").data("opts"),c=b.datePicker;c.find("a.current").removeClass("current"),a.addClass("current");var d=moment(a.attr("data-date")),e=$.fcdp.getFieldDate(b)||$.fcdp.getWorkingDate(b);d.hours(e.hours()).minutes(e.minutes()).seconds(e.seconds()),$.fcdp.setFieldDate(b,d),b.input.trigger("dateChange",[b]),c.hide()}))},execute:function(a,b,c,d){switch(b){case"bindBehavior":this.bindBehavior(a,c,d)}},bindBehavior:function(a,b,c){if($.isFunction(c)){var d=a.data("behaviors");d=d||{},d[b]=d[b]||[],d[b].push(c),a.data("behaviors",d)}},executeBehavior:function(a,b,c){var d=null,e=b.input.data("behaviors");return e&&e[a]&&$.each(e[a],function(){$.isFunction(this)&&(d=this(b,c,d))}),d}},$(document).ready(function(){$.fcdp.init()}),Date.prototype.getDayOfTheYear=function(){var a=new Date(this.getFullYear(),0,1);return Math.ceil((this-a)/864e5)},Date.prototype.format=function(a){a=a||"%Y-%m-%d %H:%M:%S";var b=a.match(/\%[-_^]{0,1}[YCymBbdejHkIlPpMSLNAauw]{1,1}/g);if(0==b.length)return a;var c=["January","February","March","April","May","June","July","August","September","October","November","December"],d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=["am","pm"],f=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],g=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];for(b=b.sort(),previous_match="",i=0;i<b.length;i++){var h=b[i];if(previous_match!=h){var j="",k=null;switch(h){case"%Y":k=/%Y/g,j=this.getFullYear();break;case"%C":k=/%C/g,j=Match.floor(this.getFullYear()/100);break;case"%y":k=/%y/g,j=(""+this.getFullYear%100).lpad(2);break;case"%m":k=/%m/g,j=(""+(this.getMonth()+1)).lpad(2);break;case"%_m":k=/%\_m/g,j=(""+(this.getMonth()+1)).lpad(2," ");break;case"%-m":k=/%\-m/g,j=""+(this.getMonth()+1);break;case"%B":k=/%B/g,j=c[this.getMonth()];break;case"%^B":k=/%\^B/g,j=c[this.getMonth()].toUpperCase();break;case"%b":k=/%b/g,j=d[this.getMonth()];break;case"%^b":k=/%\^b/g,j=d[this.getMonth()].toUpperCase();break;case"%d":k=/%d/g,j=(""+this.getDate()).lpad(2);break;case"%-d":k=/%\-d/g,j=""+this.getDate();break;case"%e":k=/%e/g,j=(""+this.getDate()).lpad(2," ");break;case"%j":k=/%j/g,j=(""+this.getDayOfTheYear()).lpad(3);break;case"%-j":k=/%\-j/g,j=""+this.getDayOfTheYear();break;case"%_j":k=/%\_j/g,j=(""+this.getDayOfTheYear()).lpad(3," ");break;case"%H":k=/%H/g,j=(""+this.getHours()).lpad(2);break;case"%-H":k=/%\-H/g,j=""+this.getHours();break;case"%_H":k=/%\_H/g,j=(""+this.getHours()).lpad(2," ");break;case"%k":k=/%k/g,j=(""+this.getHours()).lpad(2," ");break;case"%I":k=/%I/g,j=(""+(this.getHours()%12==0?12:this.getHours()%12)).lpad(2);break;case"%-I":k=/%\-I/g,j=""+(this.getHours()%12==0?12:this.getHours()%12);break;case"%_I":k=/%\_I/g,j=(""+(this.getHours()%12==0?12:this.getHours()%12)).lpad(2," ");break;case"%l":k=/%l/g,j=(""+(this.getHours()%12==0?12:this.getHours()%12)).lpad(2," ");break;case"%P":k=/%P/g,j=e[Math.floor(this.getHours()/12)];break;case"%p":k=/%p/g,j=e[Math.floor(this.getHours()/12)].toUpperCase();break;case"%M":k=/%M/g,j=(""+this.getMinutes()).lpad(2);break;case"%S":k=/%S/g,j=(""+this.getSeconds()).lpad(2);break;case"%A":k=/%A/g,j=f[this.getDay()];break;case"%^A":k=/%\^A/g,j=f[this.getDay()].toUpperCase;break;case"%a":k=/%a/g,j=g[this.getDay()];break;case"%^a":k=/%\^a/g,j=g[this.getDay()].toUpperCase;break;case"%w":k=/%w/g,j=""+this.getDay();break;case"%u":k=/%u/g,j=""+(0==this.getDay()?7:this.getDay())}a=a.replace(k,j),previous_match=h}}return a},String.prototype.lpad=function(a,b){return b=b||"0",str=this+"",str.length>=a?str:new Array(a-str.length+1).join(b)+str},String.prototype.rpad=function(a,b){return b=b||"0",str=this+"",str.length>=a?str:str+new Array(a-str.length+1).join(b)};